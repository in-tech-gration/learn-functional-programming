<html>
<head>
	<meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/codemirror/codemirror.css">
	<link rel="stylesheet" href="assets/app/site.css">
	<title>Functional Programming in Javascript</title>
	<script type="text/javascript">
		// Adds the implementation for Array.prototype.concatAll()
		function defineConcatAll() {
			Array.prototype.concatAll = function () {
				var results = [];

				this.forEach(function(subArray) {
					results.push.apply(results, subArray);
				});

				return results;
			};
		}

		/**
		 * Add the implementation for Array.prototype.concatMap()
		 */
		function defineConcatMap() {
			Array.prototype.concatMap = function(fnc) {
				return this.
					map(function (e) {
						return fnc(e);
					}).
					// apply the concatAll function to flatten the two-dimensional array
					concatAll();
			};
		}

		/**
		 * This function will be executed at the begining of each verifier function
		 */
		function preVerifierHook() {
			// Add helpers to prevent 'undefined is not a function' like errors
			defineConcatAll();
			defineConcatMap();
		}
	</script>
</head>
<body>
<div class="content">
	<div class="grab-answers">
		<p>This is an interactive learning course with exercises you fill out right in the browser. <b>If you just want to browse the content click the button below</b>:</p>
		<button class="green-button show-answers">Show all the answers so I can just browse.</button>
	</div>
	<h1 class="center">Functional Programming in Javascript</h1>

	<p>This is a series of interactive exercises for training yourself to use functional programming to manipulate collections. 
		Functional programming provides developers with the tools to abstract common collection operations into reusable,
		composable building blocks. You'll be surprised to learn that most of the operations you perform on collections can be accomplished with
		<b>five simple functions</b>:
	</p>
	<ol>
		<li>map</li>
		<li>filter</li>
		<li>concatAll</li>
		<li>reduce</li>
		<li>zip</li>
	</ol>

	<p>Here's my promise to you: if you learn these 5 functions your code will become shorter, more self-descriptive,
		and more durable. Also, for reasons that might not be obvious right now, you'll learn that these five functions
		hold the key to simplifying asynchronous programming. Once you've finished this tutorial you'll also have all
		the tools you need to easily avoid race conditions, propagate and handle asynchronous errors, and sequence
		events and AJAX requests. In short,
		<b>these 5 functions will probably be the most powerful, flexible, and useful functions you'll ever learn.</b>
	</p>

	<h2>Finishing the Interactive Exercises</h2>

	<p>This isn't just a tutorial, it's a
		<b>series of interactive exercises that you can fill out right in your browser!</b> It's easy to finish the
		exercises. Just edit the code and press "Run." If the code works, a new exercise will appear below. Otherwise an
		error will appear.
	</p>
	<p><b>Note:</b> Use the "F4" key to toggle full screen mode for each editor.</p>

	<p>This tutorial may have bugs, so if you get into a weird state or you're sure you've got the right answer but
		can't move on, just refresh your browser. If you're using a modern browser, and if you're here I assume you are,
		the state of your exercises will be saved. If you want, you can also
		<a href="javascript:localStorage.newState = ''; document.location.reload();">restart the lab.</a></p>

	<p>This tutorial is on
		<a href="https://github.com/in-tech-gration/learn-functional-programming">GitHub</a>, and is asymptotically approaching
		completion. If you'd like to add an exercise, clarify a problem description, or fix a bug feel free to
		<a href="https://github.com/in-tech-gration/learn-functional-programming/fork">fork</a> and send us a pull request. We'll
		try and fit user-contributed exercises into a narrative.
	</p>
	<div class="grab-answers">
		<p>Your answers will be saved in local storage. Use the buttons below if you want to transfer them to another machine:</p>
		<button class="green-button get-answer">Get Answers as JSON</button>
		<button class="blue-button set-answer">Set JSON Answers</button>
	</div>

	<h2>Working with Arrays</h2>

	<p>The Array is Javascript's only collection type. Arrays are everywhere. We're going to add the five functions to
		the Array type, and in the process make it much more powerful and useful. As a matter of fact, Array already has
		the map, filter, and reduce functions! However we're going to reimplement these functions as a learning
		exercise.</p>

	<p>This section will follow a pattern. First we'll solve problems the way you probably learned in school, or on your
		own by reading other people's code. In other words, we'll transform collections into new collections using loops
		and statements. Then we'll implement one of the five functions, and then use it to solve the same problem again
		<i>without</i> the loop. Once we've learned the five functions, you'll learn how to combine them to solve
		complex problems with very little code. The first two exercises have been completed in advance, but please look
		them over carefully!
	</p>

	<h3>Traversing an Array</h3>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson" style="visibility: visible">
		<h4>Exercise 1: Print all the names in an array</h4>
		<textarea class="code" rows="8" cols="80">
			function(console) {
				var names = ["Ben", "Jafar", "Matt", "Priya", "Brian"],
					counter;

				for(counter = 0; counter < names.length; counter++) {
					console.log(names[counter]);
				}
			}
		</textarea>
		<button class="go">Run</button>
		<span class="aside">&lt;- Click here to try your solution. If it works, you'll move on to the next exercise.</span>

		<div class="output"></div>

		<pre class="verifier">
			// Traverse array with for loop
			function(str) {
				preVerifierHook();
				var fun = eval("(" + str + ")");
				var items = [];
				var got;
				var expected = '["Ben","Brian","Jafar","Matt","Priya"]';
				fun({
					log:function(name) {
						items.push(name);
						console.log(name);
					}
				});

				got = JSON.stringify(items.sort());
				if(got === expected) {
					return "Success!"
				}
				else {
					showLessonErrorMessage(expected, got, 'Note: order does not matter');
				}
			}
		</pre>
		<pre class="answer">
			function(console) {
				var names = ["Ben", "Jafar", "Matt", "Priya", "Brian"],
					counter;

				for(counter = 0; counter < names.length; counter++) {
					console.log(names[counter]);
				}
			}
		</pre>
		<p class="post">Ask yourself this question: <b>did we need to specify the <i>order</i> in which the names were
			printed?</b> If not, why do it?
		</p>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 2: Use forEach to print all the names in an array</h4>
		<p>Let's repeat the previous exercise using the forEach function.</p>

		<textarea class="code" rows="8" cols="80">
			function(console) {
				var names = ["Ben", "Jafar", "Matt", "Priya", "Brian"];

				names.forEach(function(name) {
					console.log(name);
				});
			}
		</textarea>
		<button class="go">Run</button>

		<div class="output"></div>

		<pre class="verifier">
			// Traverse array with foreach
			function(str) {
				preVerifierHook();
				if (str.indexOf(".forEach") === -1) {
					return "You have to use forEach!"
				}
				var fun = eval("(" + str + ")");
				var items =[];
				fun({
					log:function(name) {
						items.push(name);
						console.log(name);
					}
				});
				if(JSON.stringify(items.sort()) === '["Ben","Brian","Jafar","Matt","Priya"]') {
					return "Success!"
				}
				else {
					throw 'console.log did not receive all of these values: "Ben","Brian","Jafar","Matt","Priya" (note: order does not matter)'
				}
			}
		</pre>

    	<pre class="answer">
			function(console) {
				var names = ["Ben", "Jafar", "Matt", "Priya", "Brian"];

				names.forEach(function(name) {
					console.log(name);
				});
			}
    	</pre>
		<div class="post">
			<p>
				Notice that forEach lets us specify <i>what</i> we want to happen to each item in the array, but hides <i>how</i> the array is traversed.
			</p>
			<h3>Projecting Arrays</h3>
			<p>Applying a function to a value and creating a new value is called a <i>projection</i>. To project one array into
				another, we apply a projection function to each item in the array and collect the results in a new array.
			</p>
		</div>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 3: Project an array of videos into an array of {id,title} pairs using forEach()</h4>

		<p>For each video, add a projected {id, title} pair to the videoAndTitlePairs array.</p>

		<textarea class="code" rows="60" cols="80">
			function() {
				var newReleases = [
					{
						"id": 70111470,
						"title": "Die Hard",
						"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
						"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": [4.0],
						"bookmark": []
					},
					{
						"id": 654356453,
						"title": "Bad Boys",
						"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
						"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": [5.0],
						"bookmark": [{ id: 432534, time: 65876586 }]
					},
					{
						"id": 65432445,
						"title": "The Chamber",
						"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
						"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": [4.0],
						"bookmark": []
					},
					{
						"id": 675465,
						"title": "Fracture",
						"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
						"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": [5.0],
						"bookmark": [{ id: 432534, time: 65876586 }]
					}
				],
				videoAndTitlePairs = [];

				// ------------ INSERT CODE HERE! -----------------------------------
				// Use forEach function to accumulate {id, title} pairs from each video.
				// Put the results into the videoAndTitlePairs array using the Array's
				// push() method. Example: videoAndTitlePairs.push(newItem);
				// ------------ INSERT CODE HERE! -----------------------------------


				return videoAndTitlePairs;
			}
		</textarea>

		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>

		<div class="output"></div>

		<pre class="verifier">
			// Projection with with forEach
			function(str) {
				preVerifierHook();
				var fun = eval("(" + str + ")"),
					videoAndTitlePairs = fun(),
					expected = '[{\"id\":675465,\"title\":\"Fracture\"},{\"id\":65432445,\"title\":\"The Chamber\"},{\"id\":70111470,\"title\":\"Die Hard\"},{\"id\":654356453,\"title\":\"Bad Boys\"}]';

				// Sorting by video id
				videoAndTitlePairs = videoAndTitlePairs.sortBy(function(video) { return video.id });
				if (JSON.stringify(videoAndTitlePairs) === expected) {
					return true;
				}
				else {
					showLessonErrorMessage(expected, JSON.stringify(videoAndTitlePairs));
				}
			}
    	</pre>
        <pre class="answer">
			function() {
				var newReleases = [
						{
							"id": 70111470,
							"title": "Die Hard",
							"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": [4.0],
							"bookmark": []
						},
						{
							"id": 654356453,
							"title": "Bad Boys",
							"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": [5.0],
							"bookmark": [{ id: 432534, time: 65876586 }]
						},
						{
							"id": 65432445,
							"title": "The Chamber",
							"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": [4.0],
							"bookmark": []
						},
						{
							"id": 675465,
							"title": "Fracture",
							"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": [5.0],
							"bookmark": [{ id: 432534, time: 65876586 }]
						}
					],
					videoAndTitlePairs = [];

				newReleases.forEach(function(video) {
					videoAndTitlePairs.push({ id: video.id, title: video.title });
				});

				return videoAndTitlePairs;
			}
		</pre>
		<div class="post">
			<p>All array projections share two operations in common:</p>
			<ol>
				<li>Traverse the source array</li>
				<li>Add each item's projected value to a new array</li>
			</ol>
			<p>Why not abstract away <i>how</i> these operations are carried out?</p>
		</div>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 4: Implement map()</h4>

		<p>To make projections easier, let's add a <b>map()</b> function to the Array type. Map accepts the projection
			function to be applied to each item in the source array, and returns the projected array.
		</p>

		<textarea class="code" rows="20" cols="80">
			Array.prototype.map = function(projectionFunction) {
				var results = [];
				this.forEach(function(itemInArray) {

					// ------------ INSERT CODE HERE! ----------------------------
					// Apply the projectionFunction to each item in the array and add
					// each result to the results array.
					// Note: you can add items to an array with the push() method.
					// ------------ INSERT CODE HERE! ----------------------------

				});

				return results;
			};

			// JSON.stringify([1,2,3].map(function(x) { return x + 1; })) === '[2,3,4]'
		</textarea>

		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>

		<div class="output"></div>

		<pre class="verifier">
			// Implement map()
			function(str) {
				preVerifierHook();
				var fun = eval(str),
					arr = [1,2,3],
					result;

				result = arr.map(function(x) { return x + 1});

				if (JSON.stringify(arr) !== "[1,2,3]") {
					throw "Whoa! You changed the input array. Map never changes the value of the array passed in. It creates a new array with the results of applying the projection function to every value in the old array."
				}
				else if(JSON.stringify(result) !== '[2,3,4]') {
					throw 'Expected that [1,2,3].map(function(x) { return x + 1}) would equal [2,3,4].'
				}
			}
		</pre>
		<pre class="answer">
			Array.prototype.map = function(projectionFunction) {
				var results = [];
				this.forEach(function(itemInArray) {
					results.push(projectionFunction(itemInArray));

				});

				return results;
			};

			// JSON.stringify([1,2,3].map(function(x) { return x + 1; })) === '[2,3,4]'
		</pre>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 5: Use map() to project an array of videos into an array of {id,title} pairs</h4>

		<p>Let's repeat the exercise of collecting {id, title} pairs for each video in the newReleases array, but <b>this
			time we'll use our map function.</b>
		</p>

		<textarea class="code" rows="60" cols="80">
			function() {
				var newReleases = [
					{
						"id": 70111470,
						"title": "Die Hard",
						"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
						"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": [4.0],
						"bookmark": []
					},
					{
						"id": 654356453,
						"title": "Bad Boys",
						"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
						"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": [5.0],
						"bookmark": [{ id: 432534, time: 65876586 }]
					},
					{
						"id": 65432445,
						"title": "The Chamber",
						"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
						"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": [4.0],
						"bookmark": []
					},
					{
						"id": 675465,
						"title": "Fracture",
						"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
						"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": [5.0],
						"bookmark": [{ id: 432534, time: 65876586 }]
					}
				];

				// ------------ INSERT CODE HERE! -----------------------------------
				// Use map function to accumulate {id, title} pairs from each video.
				return newReleases.map // finish this expression!
				// ------------ INSERT CODE HERE! -----------------------------------

			}
		</textarea>

		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output"></div>

		<pre class="verifier">
			// Projection with map
			function(str) {
				preVerifierHook();
				var fun = eval("(" + str + ")"),
					videoAndTitlePairs = fun(),
					expected = '[{\"id\":675465,\"title\":\"Fracture\"},{\"id\":65432445,\"title\":\"The Chamber\"},{\"id\":70111470,\"title\":\"Die Hard\"},{\"id\":654356453,\"title\":\"Bad Boys\"}]';

				// Sorting by video id
				videoAndTitlePairs = videoAndTitlePairs.sortBy(function(video) { return video.id });
				if (JSON.stringify(videoAndTitlePairs) === expected) {
					return true;
				}
				else {
					throw 'Expected: ' + expected;
				}
			}
		</pre>
		<pre class="answer">
			function() {
				var newReleases = [
						{
							"id": 70111470,
							"title": "Die Hard",
							"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": [4.0],
							"bookmark": []
						},
						{
							"id": 654356453,
							"title": "Bad Boys",
							"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": [5.0],
							"bookmark": [{ id: 432534, time: 65876586 }]
						},
						{
							"id": 65432445,
							"title": "The Chamber",
							"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": [4.0],
							"bookmark": []
						},
						{
							"id": 675465,
							"title": "Fracture",
							"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": [5.0],
							"bookmark": [{ id: 432534, time: 65876586 }]
						}
					];

			  return newReleases.map(function(video) { return { id: video.id, title: video.title }; });
			}
		</pre>
		<div class="post">
			<p>Notice that map allows us to specify <i>what</i> projection we want to apply to an array, but hides
				<i>how</i> the operation is carried out.
			</p>
			<h3>Filtering Arrays</h3>
			<p>Like projection, filtering an array is also a very common operation. To filter an array we apply a test to each item
				in the array and collect the items that pass into a new array.
			</p>
		</div>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 6: Use forEach() to collect only those videos with a rating of 5.0</h4>

		<p>Use forEach() to loop through the videos in the newReleases array and, if a video has a rating of 5.0, add it to
			the videos array.
		</p>

		<textarea class="code" rows="60" cols="80">
			function() {
				var newReleases = [
					{
						"id": 70111470,
						"title": "Die Hard",
						"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
						"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": 4.0,
						"bookmark": []
					},
					{
						"id": 654356453,
						"title": "Bad Boys",
						"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
						"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": 5.0,
						"bookmark": [{ id: 432534, time: 65876586 }]
					},
					{
						"id": 65432445,
						"title": "The Chamber",
						"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
						"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": 4.0,
						"bookmark": []
					},
					{
						"id": 675465,
						"title": "Fracture",
						"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
						"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": 5.0,
						"bookmark": [{ id: 432534, time: 65876586 }]
					}
				],
				videos = [];

				// ------------ INSERT CODE HERE! -----------------------------------
				// Use forEach function to accumulate every video with a rating of 5.0
				// ------------ INSERT CODE HERE! -----------------------------------

				return videos;
			}
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output"></div>

		<pre class="verifier">
			// Filter with forEach
			function(str) {
				preVerifierHook();
				var fun = eval("(" + str + ")"),
					videos = fun(),
					expected = '[{"id":675465,"title":"Fracture","boxart":"http://cdn-0.nflximg.com/images/2891/Fracture.jpg","uri":"http://api.netflix.com/catalog/titles/movies/70111470","rating":5,"bookmark":[{"id":432534,"time":65876586}]},{"id":654356453,"title":"Bad Boys","boxart":"http://cdn-0.nflximg.com/images/2891/BadBoys.jpg","uri":"http://api.netflix.com/catalog/titles/movies/70111470","rating":5,"bookmark":[{"id":432534,"time":65876586}]}]';

				// Sorting by video id
				videos = videos.sortBy(function(v) { return v.id; });
				if (JSON.stringify(videos) === expected) {
					return true;
				}
				else {
					throw 'Expected: ' + expected;
				}
			}
		</pre>
		<pre class="answer">
			function() {
				var newReleases = [
						{
							"id": 70111470,
							"title": "Die Hard",
							"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 4.0,
							"bookmark": []
						},
						{
							"id": 654356453,
							"title": "Bad Boys",
							"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 5.0,
							"bookmark": [{ id: 432534, time: 65876586 }]
						},
						{
							"id": 65432445,
							"title": "The Chamber",
							"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 4.0,
							"bookmark": []
						},
						{
							"id": 675465,
							"title": "Fracture",
							"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 5.0,
							"bookmark": [{ id: 432534, time: 65876586 }]
						}
					],
					videos = [];

				newReleases.forEach(function(video) {
					if (video.rating === 5.0) {
						videos.push(video);
					}
				});

				return videos;
			}
		</pre>

		<div class="post">
			<p>Notice that, like map(), <b>every filter() operation shares some operations in common</b>:</p>
			<ol>
				<li>Traverse the array</li>
				<li>Add objects that pass the test to a new array</li>
			</ol>
			<p>Why not abstract away how these operations are carried out?</p>
		</div>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 7: Implement filter()</h4>

		<p>To make filtering easier, let's add a filter() function to the Array type. The filter() function accepts a <i>predicate</i>.
			A predicate is a function that accepts an item in the array, and returns a boolean indicating whether the item
			should be retained in the new array.</p>

		<textarea class="code" rows="20" cols="80">
			Array.prototype.filter = function(predicateFunction) {
				var results = [];
				this.forEach(function(itemInArray) {
					// ------------ INSERT CODE HERE! ----------------------------
					// Apply the predicateFunction to each item in the array.
					// If the result is truthy, add the item to the results array.
					// Note: remember you can add items to the array using the array's
					// push() method.
					// ------------ INSERT CODE HERE! ----------------------------
				});

				return results;
			};

			// JSON.stringify([1,2,3].filter(function(x) { return x > 2})) === "[3]"
		</textarea>

		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output"></div>

		<pre class="verifier">
			// Implement filter()
			function(str) {
				preVerifierHook();
				var fun = eval(str),
					arr = [1,2,3],
					result;

				result = arr.filter(function(x) { return x > 2});

				if (JSON.stringify(arr) !== "[1,2,3]") {
					throw "Whoa! You changed the input array. Filter never changes the value of the array passed in. It creates a new array that includes only those items in the old array that pass the predicate function."
				}
				else if(JSON.stringify(result) !== '[3]') {
					throw 'Expected that [1,2,3].filter(function(x) { return x > 2}) would equal [3].'
				}
			}
		</pre>
		<pre class="answer">
			Array.prototype.filter = function(predicateFunction) {
				var results = [];
				this.forEach(function(itemInArray) {
				  if (predicateFunction(itemInArray)) {
					results.push(itemInArray);
				  }
				});

				return results;
			};

			// JSON.stringify([1,2,3].filter(function(x) { return x > 2})) === "[3]"
		</pre>
		<p class="post">Like map(), filter() lets us express <i>what</i> data we want without requiring us to specify <i>how</i>
			we want to collect the data.</p>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h3>Query Data by Chaining Method Calls</h3>
		<h4>Exercise 8: Chain filter and map to collect the ids of videos that have a rating of 5.0</h4>
		<textarea class="code" rows="60" cols="80">
			function() {
				var newReleases = [
					{
						"id": 70111470,
						"title": "Die Hard",
						"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
						"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": 4.0,
						"bookmark": []
					},
					{
						"id": 654356453,
						"title": "Bad Boys",
						"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
						"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": 5.0,
						"bookmark": [{ id: 432534, time: 65876586 }]
					},
					{
						"id": 65432445,
						"title": "The Chamber",
						"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
						"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": 4.0,
						"bookmark": []
					},
					{
						"id": 675465,
						"title": "Fracture",
						"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
						"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
						"rating": 5.0,
						"bookmark": [{ id: 432534, time: 65876586 }]
					}
				];

				// ------------ INSERT CODE HERE! -----------------------------------
				// Chain the filter and map functions to select the id of all videos
				// with a rating of 5.0.

				return newReleases // Complete this expression
				// ------------ INSERT CODE HERE! -----------------------------------
			}
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output"></div>

		<pre class="verifier">
			// Filter with filter()
			function(str) {
				preVerifierHook();
				var fun = eval("(" + str + ")"),
					videoids = fun(),
					expected = '[675465,654356453]';

				// Sorting by video id
				videoids = videoids.sortBy(function(v) { return v; });
				if (JSON.stringify(videoids) === expected) {
					return true;
				}
				else {
					throw 'Expected: ' + expected;
				}
			}
			</pre>
		<pre class="answer">
			function() {
				var newReleases = [
						{
							"id": 70111470,
							"title": "Die Hard",
							"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 4.0,
							"bookmark": []
						},
						{
							"id": 654356453,
							"title": "Bad Boys",
							"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 5.0,
							"bookmark": [{ id: 432534, time: 65876586 }]
						},
						{
							"id": 65432445,
							"title": "The Chamber",
							"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 4.0,
							"bookmark": []
						},
						{
							"id": 675465,
							"title": "Fracture",
							"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 5.0,
							"bookmark": [{ id: 432534, time: 65876586 }]
						}
					];

				return newReleases.
					filter(function(video) {
						return video.rating === 5.0;
					}).
					map(function(video) {
						return video.id;
					});
			}
		</pre>

		<p class="post">Chaining together map() and filter() gives us a lot of expressive power. These high level functions
			let us express <i>what</i> data we want, but leave the underlying libraries a great deal of flexibility in terms
			of <i>how</i> our queries are executed.</p>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h3>Querying Trees</h3>
		<p>Sometimes, in addition to flat arrays, we need to query trees. Trees pose a challenge because we need to flatten them
			into arrays in order to apply filter() and map() operations on them. In this section we'll define a concatAll()
			function that we can combine with map() and filter() to query trees.</p>

		<h4>Exercise 9: Flatten the movieLists array into an array of video ids</h4>

		<p>Let's start by using two nested forEach loops to collect the id of every video in the two-dimensional movieLists
			array.</p>

		<textarea class="code" rows="60" cols="80">
			function() {
				var movieLists = [
					{
						name: "New Releases",
						videos: [
							{
								"id": 70111470,
								"title": "Die Hard",
								"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
								"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
								"rating": 4.0,
								"bookmark": []
							},
							{
								"id": 654356453,
								"title": "Bad Boys",
								"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
								"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
								"rating": 5.0,
								"bookmark": [{ id: 432534, time: 65876586 }]
							}
						]
					},
					{
						name: "Dramas",
						videos: [
							{
								"id": 65432445,
								"title": "The Chamber",
								"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
								"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
								"rating": 4.0,
								"bookmark": []
							},
							{
								"id": 675465,
								"title": "Fracture",
								"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
								"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
								"rating": 5.0,
								"bookmark": [{ id: 432534, time: 65876586 }]
							}
						]
					}
				],
				allVideoIdsInMovieLists = [];

				// ------------   INSERT CODE HERE!  -----------------------------------
				// Use two nested forEach loops to flatten the movieLists into a list of
				// video ids.
				// ------------   INSERT CODE HERE!  -----------------------------------

				return allVideoIdsInMovieLists;

			}
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output"></div>

		<pre class="verifier">
			// Use filter and map to collect video ids with rating of 5.0
			function(str) {
				var fun = eval("(" + str + ")"),
					videos = fun(),
					expected = '[675465,65432445,70111470,654356453]';

				videos = videos.sortBy(function(v) { return v });
				if (JSON.stringify(videos) !== expected) {
					throw "Expected " + expected;
				}
			}
		</pre>
		<pre class="answer">
			function() {
				var movieLists = [
						{
							name: "New Releases",
							videos: [
								{
									"id": 70111470,
									"title": "Die Hard",
									"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
									"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 4.0,
									"bookmark": []
								},
								{
									"id": 654356453,
									"title": "Bad Boys",
									"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
									"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 5.0,
									"bookmark": [{ id: 432534, time: 65876586 }]
								}
							]
						},
						{
							name: "Dramas",
							videos: [
								{
									"id": 65432445,
									"title": "The Chamber",
									"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
									"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 4.0,
									"bookmark": []
								},
								{
									"id": 675465,
									"title": "Fracture",
									"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
									"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 5.0,
									"bookmark": [{ id: 432534, time: 65876586 }]
								}
							]
						}
					],
					allVideoIdsInMovieLists = [];

				movieLists.forEach(function(movieList) {
					movieList.videos.forEach(function(video) {
						allVideoIdsInMovieLists.push(video.id);
					});
				});

				return allVideoIdsInMovieLists;

			}
		</pre>

		<p class="post">Flattening trees with nested forEach expressions is easy because we can explicitly add items to the
			array. Unfortunately it's <i>exactly</i> this type of low-level operation that we've been trying to abstract
			away with functions like map() and filter(). Can we define a function that's abstract enough to express our <i>intent</i>
			to flatten a tree, without specifying too much information about <i>how</i> to carry out the operation?</p>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 10: Implement concatAll()</h4>

		<p>Let's add a concatAll() function to the Array type. The concatAll() function iterates over each sub-array in the
			array and collects the results in a new, flat array. Notice that <b>the concatAll() function expects each item in
				the array to be another array.</b>
		</p>

		<textarea class="code" rows="20" cols="80">
			Array.prototype.concatAll = function() {
				var results = [];
				this.forEach(function(subArray) {
					// ------------ INSERT CODE HERE! ----------------------------
					// Add all the items in each subArray to the results array.
					// ------------ INSERT CODE HERE! ----------------------------
				});

				return results;
			};

			// JSON.stringify([ [1,2,3], [4,5,6], [7,8,9] ].concatAll()) === "[1,2,3,4,5,6,7,8,9]"
			// [1,2,3].concatAll(); // throws an error because this is a one-dimensional array
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output"></div>

		<pre class="verifier">
			// Flatten movieLists into an array of video ids
			function(str) {
				preVerifierHook();
				var fun = eval(str),
					arr = [[1,2,3],[4,5,6],[7,8,9]],
					result,
					expected = "[1,2,3,4,5,6,7,8,9]";

				result = arr.concatAll();
				result = result.sortBy(function(x) { return x; });
				if (JSON.stringify(result) !== expected) {
					throw 'Expected that [[1,2,3],[4,5,6],[7,8,9]].concatAll() would equal [1,2,3,4,5,6,7,8,9].'
				}
			}
		</pre>
		<pre class="answer">
			Array.prototype.concatAll = function() {
				var results = [];
				this.forEach(function(subArray) {
					results.push.apply(results, subArray);
				});

				return results;
			};

			// JSON.stringify([ [1,2,3], [4,5,6], [7,8,9] ].concatAll()) === "[1,2,3,4,5,6,7,8,9]"
			// [1,2,3].concatAll(); // throws an error because this is a one-dimensional array
		</pre>
		<p class="post">concatAll is a very simple function, so much so that it may not be obvious yet how it can be combined
			with map() to query a tree. Let's try an example...</p>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 11: Use map() and concatAll() to project and flatten the movieLists into an array of video ids</h4>

		<p>Hint: use two nested calls to map() and one call to concatAll().</p>
		<textarea class="code" rows="60" cols="80">
			function() {
				var movieLists = [
						{
							name: "New Releases",
							videos: [
								{
									"id": 70111470,
									"title": "Die Hard",
									"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
									"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 4.0,
									"bookmark": []
								},
								{
									"id": 654356453,
									"title": "Bad Boys",
									"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
									"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 5.0,
									"bookmark": [{ id: 432534, time: 65876586 }]
								}
							]
						},
						{
							name: "Dramas",
							videos: [
								{
									"id": 65432445,
									"title": "The Chamber",
									"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
									"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 4.0,
									"bookmark": []
								},
								{
									"id": 675465,
									"title": "Fracture",
									"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
									"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 5.0,
									"bookmark": [{ id: 432534, time: 65876586 }]
								}
							]
						}
					];

				// ------------   INSERT CODE HERE!  -----------------------------------
				// Use map and concatAll to flatten the movieLists in a list of video ids.
				// ------------   INSERT CODE HERE!  -----------------------------------

				return movieLists // Complete this expression!

			}
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output"></div>

		<pre class="verifier">
			function(str) {
				preVerifierHook();
				var fun = eval("(" + str + ")"),
					videos = fun(),
					expected = '[675465,65432445,70111470,654356453]';

				videos = videos.sortBy(function(v) { return v });
				if (JSON.stringify(videos) !== expected) {
					throw "Expected " + expected + "\n\nReceived " + JSON.stringify(videos);
				}
			}
		</pre>
		<pre class="answer">
			function() {
				var movieLists = [
						{
							name: "New Releases",
							videos: [
								{
									"id": 70111470,
									"title": "Die Hard",
									"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
									"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 4.0,
									"bookmark": []
								},
								{
									"id": 654356453,
									"title": "Bad Boys",
									"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
									"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 5.0,
									"bookmark": [{ id: 432534, time: 65876586 }]
								}
							]
						},
						{
							name: "Dramas",
							videos: [
								{
									"id": 65432445,
									"title": "The Chamber",
									"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
									"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 4.0,
									"bookmark": []
								},
								{
									"id": 675465,
									"title": "Fracture",
									"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
									"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 5.0,
									"bookmark": [{ id: 432534, time: 65876586 }]
								}
							]
						}
					];

				return movieLists.
				  map(function(movieList) {
					return movieList.videos.map(function(video) {
						return video.id;
					  });
				  }).
				  concatAll();

			}
		</pre>

		<p class="post">Wow! <b>Great work.</b> Mastering the combination of map() and concatAll() is key to effective
			functional programming. You're half way there! Let's try a more complicated example...</p>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 12: Retrieve id, title, and a 150x200 box art url for every video</h4>

		<p>You've managed to flatten a tree that's two levels deep, let's try for three! Let's say that instead of a single
			boxart url on each video, we had a collection of boxart objects, each with a different size and url. Create a
			query that selects {id, title, boxart} for every video in the movieLists. This time though, the boxart property
			in the result will be the url of the boxart object with dimensions of 150x200px. Let's see if you can solve this
			problem with map(), concatAll(), and filter().</p>
		<a name="indexers"></a>

		<p><b>There's just more one thing: you <u>can't</u> use indexers.</b> In other words, this is
			<span style="color:red">illegal</span>:</p>
			<pre>
				var itemInArray = movieLists<span style="color:red">[0]</span>;
			</pre>

		<p>Furthermore, <b>you're not allowed to use indexers in any of the remaining exercises</b> unless you're
			implementing one of the five functions. There is a very good reason for this restriction, and that reason will
			eventually be explained. For now, you'll simply have to accept it on faith that this restriction serves a
			purpose. :-)</p>

		<textarea class="code" rows="60" cols="80">
			function() {
				var movieLists = [
						{
							name: "Instant Queue",
							videos : [
								{
									"id": 70111470,
									"title": "Die Hard",
									"boxarts": [
										{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
										{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" }
									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 4.0,
									"bookmark": []
								},
								{
									"id": 654356453,
									"title": "Bad Boys",
									"boxarts": [
										{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
										{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" }

									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 5.0,
									"bookmark": [{ id: 432534, time: 65876586 }]
								}
							]
						},
						{
							name: "New Releases",
							videos: [
								{
									"id": 65432445,
									"title": "The Chamber",
									"boxarts": [
										{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" },
										{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" }
									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 4.0,
									"bookmark": []
								},
								{
									"id": 675465,
									"title": "Fracture",
									"boxarts": [
										{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
										{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
										{ width: 300, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" }
									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 5.0,
									"bookmark": [{ id: 432534, time: 65876586 }]
								}
							]
						}
					];


				// Use one or more map, concatAll, and filter calls to create an array with the following items
				// [
				//	 {"id": 675465,"title": "Fracture","boxart":"http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
				//	 {"id": 65432445,"title": "The Chamber","boxart":"http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" },
				//	 {"id": 654356453,"title": "Bad Boys","boxart":"http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" },
				//	 {"id": 70111470,"title": "Die Hard","boxart":"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" }
				// ];

				return movieLists // Complete this expression!

			}
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output">
		</div>

		<pre class="verifier">
			function(str) {
				preVerifierHook();
				var fun = eval("(" + str + ")"),
					videos = fun(),
					got,
					expected = JSON.stringify([
						{"id": 675465,"title": "Fracture","boxart":"http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
						{"id": 65432445,"title": "The Chamber","boxart":"http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" },
						{"id": 654356453,"title": "Bad Boys","boxart":"http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" },
						{"id": 70111470,"title": "Die Hard","boxart":"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" }
					].sortBy(function(v) { return v.id }));

				if (str.indexOf('[0]') !== -1) {
					throw "You're not allowed to index into the array. You might be creating the object too early. Instead of using an indexer to get the boxart out of the array, try adding a call to map() and creating the object inside the projection function.";
				}

				videos = videos.sortBy(function(v) { return v.id });
				got = JSON.stringify(videos);
				if (got !== expected) {
					showLessonErrorMessage(expected, got);
				}
			}
		</pre>
		<pre class="answer">
			function() {
				var movieLists = [
						{
							name: "Instant Queue",
							videos : [
								{
									"id": 70111470,
									"title": "Die Hard",
									"boxarts": [
										{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
										{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" }
									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 4.0,
									"bookmark": []
								},
								{
									"id": 654356453,
									"title": "Bad Boys",
									"boxarts": [
										{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
										{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" }

									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 5.0,
									"bookmark": [{ id: 432534, time: 65876586 }]
								}
							]
						},
						{
							name: "New Releases",
							videos: [
								{
									"id": 65432445,
									"title": "The Chamber",
									"boxarts": [
										{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" },
										{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" }
									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 4.0,
									"bookmark": []
								},
								{
									"id": 675465,
									"title": "Fracture",
									"boxarts": [
										{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
										{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
										{ width: 300, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" }
									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 5.0,
									"bookmark": [{ id: 432534, time: 65876586 }]
								}
							]
						}
					];

				return movieLists.
				  map(function(movieList) {
					return movieList.videos.
					  map(function(video) {
						return video.boxarts.
						  filter(function(boxart) {
							return boxart.width === 150 && boxart.height === 200;
						  }).
						  map(function(boxart) {
							return {id: video.id, title: video.title, boxart: boxart.url};
						  });
					  }).
					  concatAll();
				  }).
				  concatAll();

			}
		</pre>
		<p class="post">Fantastic job! Now you've learned to use concatAll() alongside map() and filter() to query trees.
			Notice that <b>map() and concatAll() are very commonly chained together.</b> Let's create a small helper function
			to help us with this common pattern.</p>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 13: Implement concatMap()</h4>

		<p>Nearly every time we flatten a tree we chain map() and concatAll(). Sometimes, if we're dealing with a tree
			several levels deep, we'll repeat this combination many times in our code. To save on typing, let's create a
			concatMap function that's just a map operation, followed by a concatAll.</p>
		<textarea class="code" rows="20" cols="80">
			Array.prototype.concatMap = function(projectionFunctionThatReturnsArray) {
				return this.
					map(function(item) {
						// ------------   INSERT CODE HERE!  ----------------------------
						// Apply the projection function to each item. The projection
						// function will return a new child array. This will create a
						// two-dimensional array.
						// ------------   INSERT CODE HERE!  ----------------------------
					}).
					// apply the concatAll function to flatten the two-dimensional array
					concatAll();
			};

			/*
				var spanishFrenchEnglishWords = [ ["cero","rien","zero"], ["uno","un","one"], ["dos","deux","two"] ];
				// collect all the words for each number, in every language, in a single, flat list
				var allWords = [0,1,2].
					concatMap(function(index) {
						return spanishFrenchEnglishWords[index];
					});

				return JSON.stringify(allWords) === '["cero","rien","zero","uno","un","one","dos","deux","two"]';
			*/
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output"></div>
		<pre class="verifier">
			// Implement concatAll
			function(str) {
				preVerifierHook();
				var fun = eval(str),
					spanishFrenchEnglishWords = [ ["cero","rien","zero"], ["uno","un","one"], ["dos","deux","two"] ],
					allWords = [0,1,2],
					result,
					expected = '["cero","rien","zero","uno","un","one","dos","deux","two"]';


				var allWords = [0,1,2].
					concatMap(function(index) {
						return spanishFrenchEnglishWords[index];
					});

				if (JSON.stringify(allWords) !== expected) {
					throw "Expected " + expected;
				}
			}
		</pre>
		<pre class="answer">
			Array.prototype.concatMap = function(projectionFunctionThatReturnsArray) {
				return this.
					map(function(item) {
						return projectionFunctionThatReturnsArray(item);
					}).
					// apply the concatAll function to flatten the two-dimensional array
					concatAll();
			};

			/*
				var spanishFrenchEnglishWords = [ ["cero","rien","zero"], ["uno","un","one"], ["dos","deux","two"] ];
				// collect all the words for each number, in every language, in a single, flat list
				var allWords = [0,1,2].
					concatMap(function(index) {
						return spanishFrenchEnglishWords[index];
					});

				return JSON.stringify(allWords) === '["cero","rien","zero","uno","un","one","dos","deux","two"]';
			*/
		</pre>


		<p class="post">Now, instead of using map().concatAll() to flatten a tree, we can just use concatMap helper
			function.</p>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 14: Use concatMap() to retrieve id, title, and 150x200 box art url for every video</h4>

		<p>Let's repeat the exercise we just performed. However this time we'll simplify the code by replacing the
			map().concatAll() calls with concatMap().</p>
		<textarea class="code" rows="60" cols="80">
			function() {
				var movieLists = [
						{
							name: "Instant Queue",
							videos : [
								{
									"id": 70111470,
									"title": "Die Hard",
									"boxarts": [
										{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
										{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" }
									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 4.0,
									"bookmark": []
								},
								{
									"id": 654356453,
									"title": "Bad Boys",
									"boxarts": [
										{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
										{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" }

									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 5.0,
									"bookmark": [{ id: 432534, time: 65876586 }]
								}
							]
						},
						{
							name: "New Releases",
							videos: [
								{
									"id": 65432445,
									"title": "The Chamber",
									"boxarts": [
										{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" },
										{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" }
									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 4.0,
									"bookmark": []
								},
								{
									"id": 675465,
									"title": "Fracture",
									"boxarts": [
										{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
										{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
										{ width: 300, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" }
									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 5.0,
									"bookmark": [{ id: 432534, time: 65876586 }]
								}
							]
						}
					];


				// Use one or more concatMap, map, and filter calls to create an array with the following items
				// [
				//	 {"id": 675465, "title": "Fracture", "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
				//	 {"id": 65432445, "title": "The Chamber", "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" },
				//	 {"id": 654356453, "title": "Bad Boys", "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" },
				//	 {"id": 70111470, "title": "Die Hard", "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" }
				// ];

				return movieLists // Complete this expression!

			}
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output"></div>

		<pre class="verifier">
			function(str) {
				preVerifierHook();
				var fun = eval("(" + str + ")"),
					videos = fun(),
					got,
					expected = JSON.stringify([
						{"id": 675465,"title": "Fracture","boxart":"http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
						{"id": 65432445,"title": "The Chamber","boxart":"http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" },
						{"id": 654356453,"title": "Bad Boys","boxart":"http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" },
						{"id": 70111470,"title": "Die Hard","boxart":"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" }
					].sortBy(function(v) { return v.id }));

				videos = videos.sortBy(function(v) { return v.id });
				got = JSON.stringify(videos);
				if (got !== expected) {
					showLessonErrorMessage(expected, got);
				}
			}
		</pre>
		<pre class="answer">
			function() {
				var movieLists = [
						{
							name: "Instant Queue",
							videos : [
								{
									"id": 70111470,
									"title": "Die Hard",
									"boxarts": [
										{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
										{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" }
									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 4.0,
									"bookmark": []
								},
								{
									"id": 654356453,
									"title": "Bad Boys",
									"boxarts": [
										{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
										{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" }

									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 5.0,
									"bookmark": [{ id: 432534, time: 65876586 }]
								}
							]
						},
						{
							name: "New Releases",
							videos: [
								{
									"id": 65432445,
									"title": "The Chamber",
									"boxarts": [
										{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" },
										{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" }
									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 4.0,
									"bookmark": []
								},
								{
									"id": 675465,
									"title": "Fracture",
									"boxarts": [
										{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
										{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
										{ width: 300, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" }
									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 5.0,
									"bookmark": [{ id: 432534, time: 65876586 }]
								}
							]
						}
					];

				return movieLists.concatMap(function(movieList) {
					return movieList.videos.concatMap(function(video) {
						return video.boxarts.
							filter(function(boxart) {
								return boxart.width === 150 && boxart.height === 200;
						  	}).
						  	map(function(boxart) {
								return {id: video.id, title: video.title, boxart: boxart.url};
							});
					  });
				  });
			}
		</pre>
		<p class="post">It's a very common pattern to see several nested concatMap operations, with the last operation being a
			map. You can think of this pattern as the functional version of a nested forEach.</p>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h3>Reducing Arrays</h3>
		<p>Sometimes we need to perform an operation on more than one item in the array <i>at the same time</i>. For example,
			let's say we need to find the largest integer in an array. We can't use a filter() operation, because it only
			examines one item at a time. To find the largest integer we need to compare items in the array to each other.
		</p>
		<p>One approach could be to select an item in the array as the <i>assumed</i> largest number (perhaps the first item),
			and then compare that value to every other item in the array. Each time we come across a number that was larger than
			our assumed largest number, we'd replace it with the larger value, and continue the process until the entire array
			was traversed.</p>
		<p>If we replaced the specific size comparison with a closure, we could write a function that handled the array
			traversal process for us. At each step our function would apply the closure to the last value and the current value
			and use the result as the last value the next time. Finally we'd be left with only one value. This process is known
			as <i>reducing</i> because we reduce many values to a single value.</p>

		<h4>Exercise 15: Use forEach to find the largest box art</h4>

		<p>In this example we use forEach to find the largest box art. Each time we examine a new boxart we update a
			variable with the currently known maximumSize. If the boxart is smaller than the maximum size, we discard it. If
			it's larger, we keep track of it. Finally we're left with a single boxart which must necessarily be the
			largest.</p>
		<textarea class="code" rows="15" cols="80">
			function() {
				var boxarts = [
						{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
						{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
						{ width: 300, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" },
						{ width: 425, height: 150, url: "http://cdn-0.nflximg.com/images/2891/Fracture425.jpg" }
					],
					currentSize,
					maxSize = -1,
					largestBoxart;

				boxarts.forEach(function(boxart) {
					currentSize = boxart.width * boxart.height;
					if (currentSize > maxSize) {
						largestBoxart = boxart;
						maxSize = currentSize;
					}
				});

				return largestBoxart;
			}
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output"></div>
		<pre class="verifier">
			// Find largest box art
			function(str){
				preVerifierHook();
				var fun = eval("(" + str + ")"),
					boxart = fun(),
					got = JSON.stringify(boxart),
					expected = JSON.stringify({ width: 425, height:150, url:"http://cdn-0.nflximg.com/images/2891/Fracture425.jpg" });

				if (got !== expected) {
					showLessonErrorMessage(expected, got);
				}
			}
		</pre>
		<pre class="answer">
			function() {
				var boxarts = [
						{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
						{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
						{ width: 300, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" },
						{ width: 425, height: 150, url: "http://cdn-0.nflximg.com/images/2891/Fracture425.jpg" }
					],
					currentSize,
					maxSize = -1,
					largestBoxart;

				boxarts.forEach(function(boxart) {
					currentSize = boxart.width * boxart.height;
					if (currentSize > maxSize) {
						largestBoxart = boxart;
						maxSize = currentSize;
					}
				});

				return largestBoxart;
			}
		</pre>
		<p class="post">This process is a reduction because we're using the information we derived from the last computation
			to calculate the current value. However in the example above, we still have to specify the method of traversal.
			Wouldn't it be nice if we could just specify what operation we wanted to perform on the last and current value?
			Let's create a helper function to perform reductions on arrays.</p>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 16: Implement reduce()</h4>

		<p>Let's add a reduce() function to the Array type. Like map. Take note this is <b>different from the reduce in ES5</b>, which returns a value instead of an Array! </p>
		<textarea class="code" rows="40" cols="80">
			// [1,2,3].reduce(function(accumulatedValue, currentValue) { return accumulatedValue + currentValue; }); === [6];
			// [1,2,3].reduce(function(accumulatedValue, currentValue) { return accumulatedValue + currentValue; }, 10); === [16];

			Array.prototype.reduce = function(combiner, initialValue) {
				var counter,
					accumulatedValue;

				// If the array is empty, do nothing
				if (this.length === 0) {
					return this;
				}
				else {
					// If the user didn't pass an initial value, use the first item.
					if (arguments.length === 1) {
						counter = 1;
						accumulatedValue = this[0];
					}
					else if (arguments.length >= 2) {
						counter = 0;
						accumulatedValue = initialValue;
					}
					else {
						throw "Invalid arguments.";
					}

					// Loop through the array, feeding the current value and the result of
					// the previous computation back into the combiner function until
					// we've exhausted the entire array and are left with only one value.
					while(counter < this.length) {
						accumulatedValue = combiner(accumulatedValue, this[counter])
						counter++;
					}

					return [accumulatedValue];
				}
			};
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output"></div>
		<pre class="verifier">
			// Implement reduce
			function(str) {
				preVerifierHook();
				var fun = eval(str),
					numbers = [1,2,3],
					sum = numbers.reduce(function(acc,curr) { return acc + curr }),
					expected = JSON.stringify([6]),
					sum2 = numbers.reduce(function(acc,curr) { return acc + curr },10),
					expected2 = JSON.stringify([16]);

				if (JSON.stringify(sum) !== expected) {
					throw "Expected that [1,2,3].reduce(function(accumulated,current) { return accumulated + current; }) === [6]. Instead got " + JSON.stringify(sum);
				}
				if (JSON.stringify(sum2) !== expected2) {
					throw "Expected that [1,2,3].reduce(function(accumulated,current) { return accumulated + current; }, 10) === [16]. Instead got " + JSON.stringify(sum2);
				}
			}
		</pre>
		<pre class="answer">
			// [1,2,3].reduce(function(accumulatedValue, currentValue) { return accumulatedValue + currentValue; }); === [6];
			// [1,2,3].reduce(function(accumulatedValue, currentValue) { return accumulatedValue + currentValue; }, 10); === [16];

			Array.prototype.reduce = function(combiner, initialValue) {
				var counter,
					accumulatedValue;

				// If the array is empty, do nothing
				if (this.length === 0) {
					return this;
				}
				else {
					// If the user didn't pass an initial value, use the first item.
					if (arguments.length === 1) {
						counter = 1;
						accumulatedValue = this[0];
					}
					else if (arguments.length >= 2) {
						counter = 0;
						accumulatedValue = initialValue;
					}
					else {
						throw "Invalid arguments.";
					}

					// Loop through the array, feeding the current value and the result of
					// the previous computation back into the combiner function until
					// we've exhausted the entire array and are left with only one function.
					while(counter < this.length) {
						accumulatedValue = combiner(accumulatedValue, this[counter])
						counter++;
					}

					return [accumulatedValue];
				}
			};
		</pre>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson"><h4>Exercise 17: Retrieve the largest rating.</h4>

		<p>Let's use our new reduce function to isolate the largest value in an array of ratings.</p>
		<textarea class="code" rows="15" cols="80">
			function() {
				var ratings = [2,3,1,4,5];

				// You should return an array containing only the largest rating. Remember that reduce always
				// returns an array with one item.
				return ratings.
					reduce   // Complete this expression
			}
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output"></div>
		<pre class="verifier">
			 // Find largest rating
			function(str){
				preVerifierHook();
				var fun = eval("(" + str + ")"),
					boxarts = fun(),
					got = JSON.stringify(boxarts),
					expected = JSON.stringify([5]);


				if (got !== expected) {
					showLessonErrorMessage(expected, got);
				}
			}
		</pre>
		<pre class="answer">
			function() {
				var ratings = [2,3,1,4,5];

				return ratings.
				  reduce(function(acc, curr) {
					if(acc > curr) {
					  return acc;
					}
					else {
					  return curr;
					}
				  });
			}
		</pre>
		<p class="post">Nice work. Now let's try combining reduce() with our other functions to build more complex
			queries.</p>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 18: Retrieve url of the largest boxart</h4>

		<p>Let's try combining reduce() with map() to reduce multiple boxart objects to a single value: the url of the
			largest box art.</p>
		<textarea class="code" rows="15" cols="80">
			function() {
				var boxarts = [
						{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
						{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
						{ width: 300, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" },
						{ width: 425, height: 150, url: "http://cdn-0.nflximg.com/images/2891/Fracture425.jpg" }
					];

				// You should return an array containing only the URL of the largest box art. Remember that reduce always
				// returns an array with one item.
				return boxarts.
					reduce   // Complete this expression
			}
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output"></div>
		<pre class="verifier">
			// Find largest box art with reduce
			function(str){
				preVerifierHook();
				var fun = eval("(" + str + ")"),
					boxarts = fun(),
					got = JSON.stringify(boxarts),
					expected = JSON.stringify(["http://cdn-0.nflximg.com/images/2891/Fracture425.jpg"]);


				if (got !== expected) {
					showLessonErrorMessage(expected, got);
				}
			}
		</pre>
		<pre class="answer">
			function() {
				var boxarts = [
						{ width: 200, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
						{ width: 150, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" },
						{ width: 300, height: 200, url: "http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" },
						{ width: 425, height: 150, url: "http://cdn-0.nflximg.com/images/2891/Fracture425.jpg" }
					];

				return boxarts.
				  reduce(function(acc,curr) {
					if (acc.width * acc.height > curr.width * curr.height) {
					  return acc;
					}
					else {
					  return curr;
					}
				  }).
				  map(function(boxart) {
					return boxart.url;
				  });
			}
		</pre>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 19: Reducing with an initial value</h4>

		<p>Sometimes when we reduce an array, we want the reduced value to be a different type than the items stored in the
			array. Let's say we have an array of videos and we want to reduce them to a single map where the key is the
			video id and the value is the video's title.</p>

		<textarea id="q18" class="code" rows="15" cols="80">
			function() {
				var videos = [
					{
						"id": 65432445,
						"title": "The Chamber"
					},
					{
						"id": 675465,
						"title": "Fracture"
					},
					{
						"id": 70111470,
						"title": "Die Hard"
					},
					{
						"id": 654356453,
						"title": "Bad Boys"
					}
				];

				// Expecting this output...
				// [
				//	 {
				//		 "65432445": "The Chamber",
				//		 "675465": "Fracture",
				//		 "70111470": "Die Hard",
				//		 "654356453": "Bad Boys"
				//	 }
				// ]
				return videos.
					reduce(function(accumulatedMap, video) {
					var obj = {};

					// ----- INSERT CODE TO ADD THE VIDEO TITLE TO THE ----
					// ----- NEW MAP USING THE VIDEO ID AS THE KEY	 ----

					// Object.assign() takes all of the enumerable properties from
					// the object listed in its second argument (obj) and assigns them
					// to the object listed in its first argument (accumulatedMap).
					return Object.assign(accumulatedMap, obj);
					},
					// Use an empty map as the initial value instead of the first item in
					// the list.
					{});
			}
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output"></div>
		<pre class="verifier">
			// Reducing with an initial value
			function(str){
				preVerifierHook();
				var fun = eval("(" + str + ")"),
					videoMap = fun()[0],
					expected = [
						{
							"65432445": "The Chamber",
							"675465": "Fracture",
							"70111470": "Die Hard",
							"654356453": "Bad Boys"
						}
					];

				if (!(videoMap["65432445"] === "The Chamber" && videoMap["675465"] === "Fracture" && videoMap["70111470"] === "Die Hard" && videoMap["654356453"] === "Bad Boys")) {
					throw "Expected " + JSON.stringify(expected);
				}
			}
		</pre>
		<pre class="answer">
			function() {
				var videos = [
					{
						"id": 65432445,
						"title": "The Chamber"
					},
					{
						"id": 675465,
						"title": "Fracture"
					},
					{
						"id": 70111470,
						"title": "Die Hard"
					},
					{
						"id": 654356453,
						"title": "Bad Boys"
					}
				];

				// Expecting this output...
				// [
				//     {
				//         "65432445": "The Chamber",
				//         "675465": "Fracture",
				//         "70111470": "Die Hard",
				//         "654356453": "Bad Boys"
				//     }
				// ]
				return videos.
					reduce(function(accumulatedMap, video) {
					var obj = {};

					// ----- INSERT CODE TO ADD THE VIDEO TITLE TO THE ----
					// ----- NEW MAP USING THE VIDEO ID AS THE KEY	 ----
					obj[video.id] = video.title;

					// Object.assign() takes all of the enumerable properties from
					// the object listed in its second argument (obj) and assigns them
					// to the object listed in its first argument (accumulatedMap).
					return Object.assign(accumulatedMap, obj);
					},
					// Use an empty map as the initial value instead of the first item in
					// the list.
					{});
			}
		</pre>

		<p class="post">Nice work. Now let's try combining reduce() with our other functions to build more complex
			queries.</p>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 20: Retrieve the id, title, and <i>smallest</i> box art url for every video.</h4>

		<p>This is a variation of the problem we solved earlier, where we retrieved the url of the boxart with a width of
			150px. This time we'll use reduce() instead of filter() to retrieve the <i>smallest</i> box art in the boxarts
			array.</p>
		<textarea class="code" rows="60" cols="80">
			function() {
				var movieLists = [
					{
						name: "New Releases",
						videos: [
							{
								"id": 70111470,
								"title": "Die Hard",
								"boxarts": [
									{ width: 150, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
									{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" }
								],
								"url": "http://api.netflix.com/catalog/titles/movies/70111470",
								"rating": 4.0,
								"bookmark": []
							},
							{
								"id": 654356453,
								"title": "Bad Boys",
								"boxarts": [
									{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
									{ width: 140, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg" }

								],
								"url": "http://api.netflix.com/catalog/titles/movies/70111470",
								"rating": 5.0,
								"bookmark": [{ id:432534, time:65876586 }]
							}
						]
					},
					{
						name: "Thrillers",
						videos: [
							{
								"id": 65432445,
								"title": "The Chamber",
								"boxarts": [
									{ width: 130, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg" },
									{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" }
								],
								"url": "http://api.netflix.com/catalog/titles/movies/70111470",
								"rating": 4.0,
								"bookmark": []
							},
							{
								"id": 675465,
								"title": "Fracture",
								"boxarts": [
									{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
									{ width: 120, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg" },
									{ width: 300, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" }
								],
								"url": "http://api.netflix.com/catalog/titles/movies/70111470",
								"rating": 5.0,
								"bookmark": [{ id:432534, time:65876586 }]
							}
						]
					}
				];


				// Use one or more concatMap, map, and reduce calls to create an array with the following items (order matters)
				// [
				//	 {"id": 675465,"title": "Fracture","boxart":"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg" },
				//	 {"id": 65432445,"title": "The Chamber","boxart":"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg" },
				//	 {"id": 654356453,"title": "Bad Boys","boxart":"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg" },
				//	 {"id": 70111470,"title": "Die Hard","boxart":"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" }
				// ];

				return movieLists.
					concatMap(function(movieList) {

					})

			}
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output">
		</div>
		<pre class="verifier">
			// Find the id, title, and smallest box art.
			function(str) {
				preVerifierHook();
				var fun = eval("(" + str + ")"),
					videos = fun(),
					got,
					expected = JSON.stringify([
						{"id": 675465,"title": "Fracture","boxart":"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg" },
						{"id": 65432445,"title": "The Chamber","boxart":"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg" },
						{"id": 654356453,"title": "Bad Boys","boxart":"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg" },
						{"id": 70111470,"title": "Die Hard","boxart":"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" }
					].sortBy(function(v) { return v.id }));

				if (str.indexOf('[0]') !== -1){
					throw "You're not allowed to index into the array. You might be creating the object too early. Instead of using an indexer to get the boxart out of the array, try adding a call to map() and creating the object inside the projection function.";
				}
				videos = videos.sortBy(function(v) { return v.id });
				got = JSON.stringify(videos);
				if (got !== expected) {
					showLessonErrorMessage(expected, got);
				}
			}
		</pre>
		<pre class="answer">
			function() {
				var movieLists = [
					{
						name: "New Releases",
						videos: [
							{
								"id": 70111470,
								"title": "Die Hard",
								"boxarts": [
									{ width: 150, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
									{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" }
								],
								"url": "http://api.netflix.com/catalog/titles/movies/70111470",
								"rating": 4.0,
								"bookmark": []
							},
							{
								"id": 654356453,
								"title": "Bad Boys",
								"boxarts": [
									{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
									{ width: 140, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg" }

								],
								"url": "http://api.netflix.com/catalog/titles/movies/70111470",
								"rating": 5.0,
								"bookmark": [{ id:432534, time:65876586 }]
							}
						]
					},
					{
						name: "Thrillers",
						videos: [
							{
								"id": 65432445,
								"title": "The Chamber",
								"boxarts": [
									{ width: 130, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg" },
									{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" }
								],
								"url": "http://api.netflix.com/catalog/titles/movies/70111470",
								"rating": 4.0,
								"bookmark": []
							},
							{
								"id": 675465,
								"title": "Fracture",
								"boxarts": [
									{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
									{ width: 120, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg" },
									{ width: 300, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" }
								],
								"url": "http://api.netflix.com/catalog/titles/movies/70111470",
								"rating": 5.0,
								"bookmark": [{ id:432534, time:65876586 }]
							}
						]
					}
				];


				// Use one or more concatMap, map, and reduce calls to create an array with the following items (order matters)
				// [
				//     {"id": 675465,"title": "Fracture","boxart":"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg" },
				//     {"id": 65432445,"title": "The Chamber","boxart":"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg" },
				//     {"id": 654356453,"title": "Bad Boys","boxart":"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg" },
				//     {"id": 70111470,"title": "Die Hard","boxart":"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" }
				// ];

				return movieLists.concatMap(function(movieList) {
				  return movieList.videos.concatMap(function(video) {
				    return video.boxarts.
					  reduce(function(acc,curr) {
						if (acc.width * acc.height < curr.width * curr.height) {
						  return acc;
						}
						else {
						  return curr;
						}
					  }).
					  map(function(boxart) {
						return {id: video.id, title: video.title, boxart: boxart.url};
					  });
				  });
				});

			}
		</pre>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h3>Zipping Arrays</h3>
		<p>Sometimes we need to combine two arrays by progressively taking an item from each and combining the pair. If you
			visualize a zipper, where each side is an array, and each tooth is an item, you'll have a good idea of how the zip
			operation works.</p>
		<h4>Exercise 21: Combine videos and bookmarks by index</h4>

		<p>Use a for loop to traverse the videos and bookmarks array at the same time. For each video and bookmark pair,
			create a {videoId, bookmarkId} pair and add it to the videoIdAndBookmarkIdPairs array.</p>
		<textarea class="code" rows="60" cols="80">
			function() {
				var videos = [
						{
							"id": 70111470,
							"title": "Die Hard",
							"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 4.0,
						},
						{
							"id": 654356453,
							"title": "Bad Boys",
							"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 5.0,
						},
						{
							"id": 65432445,
							"title": "The Chamber",
							"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 4.0,
						},
						{
							"id": 675465,
							"title": "Fracture",
							"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 5.0,
						}
					],
					bookmarks = [
						{id: 470, time: 23432},
						{id: 453, time: 234324},
						{id: 445, time: 987834}
					],
				counter,
				videoIdAndBookmarkIdPairs = [];

				for(counter = 0; counter < Math.min(videos.length, bookmarks.length); counter++) {
					// Insert code here to create a {videoId, bookmarkId} pair and add it to the videoIdAndBookmarkIdPairs array.
				}

				return videoIdAndBookmarkIdPairs;
			}
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output"></div>
		<pre class="verifier">
			// Zip imperatively
			function(str) {
				preVerifierHook();
				var fun = eval("(" + str + ")"),
					pairs = fun(),
					got,
					expected = '[{"videoId":65432445,"bookmarkId":445},{"videoId":70111470,"bookmarkId":470},{"videoId":654356453,"bookmarkId":453}]';

				pairs = pairs.sortBy(function(v) { return v.videoId });
				got = JSON.stringify(pairs);
				if (got !== expected) {
					showLessonErrorMessage(expected, got);
				}
			}
		</pre>
		<pre class="answer">
			function() {
				var videos = [
						{
							"id": 70111470,
							"title": "Die Hard",
							"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 4.0,
						},
						{
							"id": 654356453,
							"title": "Bad Boys",
							"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 5.0,
						},
						{
							"id": 65432445,
							"title": "The Chamber",
							"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 4.0,
						},
						{
							"id": 675465,
							"title": "Fracture",
							"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 5.0,
						}
					],
					bookmarks = [
						{id: 470, time: 23432},
						{id: 453, time: 234324},
						{id: 445, time: 987834}
					],
				counter,
				videoIdAndBookmarkIdPairs = [];

				for(counter = 0; counter < Math.min(videos.length, bookmarks.length); counter++) {
				  videoIdAndBookmarkIdPairs.push({videoId: videos[counter].id, bookmarkId: bookmarks[counter].id});
				}

				return videoIdAndBookmarkIdPairs;
			}
		</pre>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 22: Implement zip</h4>

		<p>Let's add a static zip() function to the Array type. The zip function accepts a combiner function, traverses each
			array at the same time, and calls the combiner function on the current item on the left-hand-side and
			right-hand-side. The zip function requires an item from each array in order to call the combiner function,
			therefore the array returned by zip will only be as large as the smallest input array.

		<p>
		<textarea class="code" rows="40" cols="80">
			// JSON.stringify(Array.zip([1,2,3],[4,5,6], function(left, right) { return left + right })) === '[5,7,9]'

			Array.zip = function(left, right, combinerFunction) {
				var counter,
					results = [];

				for(counter = 0; counter < Math.min(left.length, right.length); counter++) {
					// Add code here to apply the combinerFunction to the left and right-hand items in the respective arrays
				}

				return results;
			};
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output"></div>
		<pre class="verifier">
			// Implement zip
			function(str) {
				preVerifierHook();
				var fun = eval(str),
					left = [1,2,3],
					right = [4,5,6],
					sum = Array.zip(left, right, function(left, right){ return left + right; }),
					expected = '[5,7,9]';

				if (JSON.stringify(sum) !== expected) {
					showLessonErrorMessage(expected, JSON.stringify(sum));
				}
			}
		</pre>
		<pre class="answer">
			// JSON.stringify(Array.zip([1,2,3],[4,5,6], function(left, right) { return left + right })) === '[5,7,9]'

			Array.zip = function(left, right, combinerFunction) {
				var counter,
					results = [];

				for(counter = 0; counter < Math.min(left.length, right.length); counter++) {
					results.push(combinerFunction(left[counter],right[counter]));
				}

				return results;
			};
        </pre>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 23: Combine videos and bookmarks by index</h4>

		<p>Let's repeat exercise 21, but this time lets use your new zip() function. For each video and bookmark pair,
			create a {videoId, bookmarkId} pair.</p>
		<textarea class="code" rows="60" cols="80">
			function() {
				var videos = [
						{
							"id": 70111470,
							"title": "Die Hard",
							"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 4.0,
						},
						{
							"id": 654356453,
							"title": "Bad Boys",
							"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 5.0,
						},
						{
							"id": 65432445,
							"title": "The Chamber",
							"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 4.0,
						},
						{
							"id": 675465,
							"title": "Fracture",
							"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 5.0,
						}
					],
					bookmarks = [
						{id: 470, time: 23432},
						{id: 453, time: 234324},
						{id: 445, time: 987834}
					];

				return Array.
					zip( //... finish this expression
			}
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output"></div>
		<pre class="verifier">
			// Combine videos and bookmarks
			function(str) {
				preVerifierHook();
				var fun = eval("(" + str + ")"),
					pairs = fun(),
					got,
					expected = '[{"videoId":65432445,"bookmarkId":445},{"videoId":70111470,"bookmarkId":470},{"videoId":654356453,"bookmarkId":453}]';

				pairs = pairs.sortBy(function(v) { return v.videoId });
				got = JSON.stringify(pairs);
				if (got !== expected) {
					showLessonErrorMessage(expected, got);
				}
			}
		</pre>
		<pre class="answer">
			function() {
				var videos = [
						{
							"id": 70111470,
							"title": "Die Hard",
							"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 4.0,
						},
						{
							"id": 654356453,
							"title": "Bad Boys",
							"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 5.0,
						},
						{
							"id": 65432445,
							"title": "The Chamber",
							"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 4.0,
						},
						{
							"id": 675465,
							"title": "Fracture",
							"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
							"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
							"rating": 5.0,
						}
					],
					bookmarks = [
						{id: 470, time: 23432},
						{id: 453, time: 234324},
						{id: 445, time: 987834}
					];

				return Array.
					zip(
					  videos,
					  bookmarks,
					  function(video, bookmark) {
						return {videoId: video.id, bookmarkId: bookmark.id};
					  });
			}
        </pre>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 24: Retrieve each video's id, title, middle interesting moment time, and <i>smallest</i> box art url.</h4>

		<p>This is a variation of the problem we solved earlier. This time each video has an interesting moments collection,
			each representing a time during which a screenshot is interesting or representative of the title as a whole. Notice
			that both the boxarts and interestingMoments arrays are located at the same depth in the tree. Retrieve the time of
			the middle interesting moment and the smallest box art url <i>simultaneously</i> with zip(). Return an {id, title,
			time, url} object for each video.</p>
		<textarea class="code" rows="60" cols="80">
			function() {
				var movieLists = [
						{
							name: "New Releases",
							videos: [
								{
									"id": 70111470,
									"title": "Die Hard",
									"boxarts": [
										{ width: 150, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
										{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" }
									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 4.0,
									"interestingMoments": [
										{ type: "End", time:213432 },
										{ type: "Start", time: 64534 },
										{ type: "Middle", time: 323133}
									]
								},
								{
									"id": 654356453,
									"title": "Bad Boys",
									"boxarts": [
										{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
										{ width: 140, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg" }

									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 5.0,
									"interestingMoments": [
										{ type: "End", time:54654754 },
										{ type: "Start", time: 43524243 },
										{ type: "Middle", time: 6575665}
									]
								}
							]
						},
						{
							name: "Instant Queue",
							videos: [
								{
									"id": 65432445,
									"title": "The Chamber",
									"boxarts": [
										{ width: 130, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg" },
										{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" }
									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 4.0,
									"interestingMoments": [
										{ type: "End", time:132423 },
										{ type: "Start", time: 54637425 },
										{ type: "Middle", time: 3452343}
									]
								},
								{
									"id": 675465,
									"title": "Fracture",
									"boxarts": [
										{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
										{ width: 120, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg" },
										{ width: 300, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" }
									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 5.0,
									"interestingMoments": [
										{ type: "End", time:45632456 },
										{ type: "Start", time: 234534 },
										{ type: "Middle", time: 3453434}
									]
								}
							]
						}
					];

				//------------ COMPLETE THIS EXPRESSION --------------
				return movieLists.
					concatMap(function(movieList) {

					});

			}
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<pre class="verifier">
			// Find id, title, smallest box art, and bookmark id
			function(str) {
				preVerifierHook();
				var fun = eval("(" + str + ")"),
					videos = fun(),
					got,
					expected = '[{"id":675465,"title":"Fracture","time":3453434,"url":"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg"},{"id":65432445,"title":"The Chamber","time":3452343,"url":"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg"},{"id":70111470,"title":"Die Hard","time":323133,"url":"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg"},{"id":654356453,"title":"Bad Boys","time":6575665,"url":"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg"}]';

				videos = videos.sortBy(function(v) { return v.id });
				got = JSON.stringify(videos);
				if (got !== expected) {
					showLessonErrorMessage(expected, got);
				}
			}
		</pre>
		<pre class="answer">
			function() {
				var movieLists = [
						{
							name: "New Releases",
							videos: [
								{
									"id": 70111470,
									"title": "Die Hard",
									"boxarts": [
										{ width: 150, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
										{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" }
									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 4.0,
									"interestingMoments": [
										{ type: "End", time:213432 },
										{ type: "Start", time: 64534 },
										{ type: "Middle", time: 323133}
									]
								},
								{
									"id": 654356453,
									"title": "Bad Boys",
									"boxarts": [
										{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
										{ width: 140, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg" }

									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 5.0,
									"interestingMoments": [
										{ type: "End", time:54654754 },
										{ type: "Start", time: 43524243 },
										{ type: "Middle", time: 6575665}
									]
								}
							]
						},
						{
							name: "Instant Queue",
							videos: [
								{
									"id": 65432445,
									"title": "The Chamber",
									"boxarts": [
										{ width: 130, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg" },
										{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" }
									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 4.0,
									"interestingMoments": [
										{ type: "End", time:132423 },
										{ type: "Start", time: 54637425 },
										{ type: "Middle", time: 3452343}
									]
								},
								{
									"id": 675465,
									"title": "Fracture",
									"boxarts": [
										{ width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
										{ width: 120, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg" },
										{ width: 300, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" }
									],
									"url": "http://api.netflix.com/catalog/titles/movies/70111470",
									"rating": 5.0,
									"interestingMoments": [
										{ type: "End", time:45632456 },
										{ type: "Start", time: 234534 },
										{ type: "Middle", time: 3453434}
									]
								}
							]
						}
					];

				//------------ COMPLETE THIS EXPRESSION --------------
				return movieLists.concatMap(function(movieList) {
					return movieList.videos.concatMap(function(video) {
						return Array.zip(
							video.boxarts.reduce(function(acc,curr) {
								if (acc.width * acc.height < curr.width * curr.height) {
							  	  	return acc;
								}
								else {
							  		return curr;
								}
						  	}),
							video.interestingMoments.filter(function(interestingMoment) {
								return interestingMoment.type === "Middle";
							}),
						  	function(boxart, interestingMoment) {
								return {id: video.id, title: video.title, time: interestingMoment.time, url: boxart.url};
						  	});
					});
				});
			}
		</pre>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h3>Powerful Queries</h3>

		<p>Now that we've learned the five operators let's flex our muscles and write some powerful queries.</p>

		<h4>Exercise 25: Converting from Arrays to Trees</h4>

		<p>When information is organized in a tree like a JSON expression, relationships point from parent to child. In
			relational systems like databases, relationships point from children to their parents. Both ways of organizing
			information are equivalent, and depending on the circumstances, we might get data organized in one way or
			another. It may surprise you to learn that you can use the 5 query functions you already know to easily convert
			between these representations. In other words, <b>not only can you query arrays from trees, you can query trees
				from arrays</b>.</p>

		<p>We have 2 arrays each containing lists, and videos respectively. Each video has a listId field indicating its
			parent list. We want to build an array of list objects, each with a name and a videos array. The videos array
			will contain the video's id and title. In other words we want to build the following structure:</p>
        <pre>
			[
				{
					"name": "New Releases",
					"videos": [
						{
							"id": 65432445,
							"title": "The Chamber"
						},
						{
							"id": 675465,
							"title": "Fracture"
						}
					]
				},
				{
					"name": "Thrillers",
					"videos": [
						{
							"id": 70111470,
							"title": "Die Hard"
						},
						{
							"id": 654356453,
							"title": "Bad Boys"
						}
					]
				}
			]
        </pre>
		<p><b>Note: please make sure when creating objects (both lists and videos) that you add properties in the same order
			as above. This doesn't impact the correctness of your code, but the verifier expects properties to be created in
			this order.</b></p>
		<textarea class="code" rows="60" cols="80">
			function() {
				var lists = [
						{
							"id": 5434364,
							"name": "New Releases"
						},
						{
							"id": 65456475,
							"name": "Thrillers"
						}
					],
					videos = [
						{
							"listId": 5434364,
							"id": 65432445,
							"title": "The Chamber"
						},
						{
							"listId": 5434364,
							"id": 675465,
							"title": "Fracture"
						},
						{
							"listId": 65456475,
							"id": 70111470,
							"title": "Die Hard"
						},
						{
							"listId": 65456475,
							"id": 654356453,
							"title": "Bad Boys"
						}
					];

				return lists. // complete this expression
			}
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output"></div>
        <pre class="verifier">
			// Combine videos and bookmarks
			function(str) {
				preVerifierHook();
				var fun = eval("(" + str + ")"),
					pairs = fun(),
					got,
					expected = '[{"name":"New Releases","videos":[{"id":65432445,"title":"The Chamber"},{"id":675465,"title":"Fracture"}]},{"name":"Thrillers","videos":[{"id":70111470,"title":"Die Hard"},{"id":654356453,"title":"Bad Boys"}]}]';

				got = JSON.stringify(pairs);
				if (got !== expected) {
					showLessonErrorMessage(expected, got);
				}
			}
		</pre>
		<pre class="answer">
			function() {
				var lists = [
						{
							"id": 5434364,
							"name": "New Releases"
						},
						{
							"id": 65456475,
							name: "Thrillers"
						}
					],
					videos = [
						{
							"listId": 5434364,
							"id": 65432445,
							"title": "The Chamber"
						},
						{
							"listId": 5434364,
							"id": 675465,
							"title": "Fracture"
						},
						{
							"listId": 65456475,
							"id": 70111470,
							"title": "Die Hard"
						},
						{
							"listId": 65456475,
							"id": 654356453,
							"title": "Bad Boys"
						}
					];

				return lists.map(function(list) {
					return {
						name: list.name,
						videos:
							videos.
								filter(function(video) {
									return video.listId === list.id;
								}).
								map(function(video) {
									return {id: video.id, title: video.title};
								})
					};
				});
			}
        </pre>
		<p class="post">Looks like you figured out that you can use map and filter to <i>join</i> two different arrays by a
			key. Now let's try a more complex example...</p>
	</div>




	<!-- ************************* LESSON ************************* -->
	<div class="lesson">
		<h4>Exercise 26: Converting from Arrays to <i>Deeper</i> Trees</h4>

		<p>Let's try creating a deeper tree structure. This time we have 4 separate arrays each containing lists, videos,
			boxarts, and bookmarks respectively. Each object has a parent id, indicating its parent. We want to build an
			array of list objects, each with a name and a videos array. The videos array will contain the video's id, title,
			bookmark time, and smallest boxart url. In other words we want to build the following structure:</p>
        <pre>
			[
				{
					"name": "New Releases",
					"videos": [
						{
							"id": 65432445,
							"title": "The Chamber",
							"time": 32432,
							"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg"
						},
						{
							"id": 675465,
							"title": "Fracture",
							"time": 3534543,
							"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture120.jpg"
						}
					]
				},
				{
					"name": "Thrillers",
					"videos": [
						{
							"id": 70111470,
							"title": "Die Hard",
							"time": 645243,
							"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard150.jpg"
						},
						{
							"id": 654356453,
							"title": "Bad Boys",
							"time": 984934,
							"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg"
						}
					]
				}
			]
        </pre>

		<p><b>Note: please make sure when creating objects (both lists and videos) that you add properties in the same order
			as above. This doesn't impact the correctness of your code, but the verifier expects properties to be created in
			this order.</b></p>
		<textarea class="code" rows="60" cols="80">
			function() {
				var lists = [
						{
							"id": 5434364,
							"name": "New Releases"
						},
						{
							"id": 65456475,
							name: "Thrillers"
						}
					],
					videos = [
						{
							"listId": 5434364,
							"id": 65432445,
							"title": "The Chamber"
						},
						{
							"listId": 5434364,
							"id": 675465,
							"title": "Fracture"
						},
						{
							"listId": 65456475,
							"id": 70111470,
							"title": "Die Hard"
						},
						{
							"listId": 65456475,
							"id": 654356453,
							"title": "Bad Boys"
						}
					],
					boxarts = [
						{ videoId: 65432445, width: 130, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg" },
						{ videoId: 65432445, width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" },
						{ videoId: 675465, width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
						{ videoId: 675465, width: 120, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg" },
						{ videoId: 675465, width: 300, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" },
						{ videoId: 70111470, width: 150, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
						{ videoId: 70111470, width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" },
						{ videoId: 654356453, width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
						{ videoId: 654356453, width: 140, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg" }
					],
					bookmarks = [
						{ videoId: 65432445, time: 32432 },
						{ videoId: 675465, time: 3534543 },
						{ videoId: 70111470, time: 645243 },
						{ videoId: 654356453, time: 984934 }
					];

				return lists. // complete this expression

			}
		</textarea>
		<button class="go">Run</button>
		<button class="showAnswer">Show Answer</button>
		<button class="fullScreen">Enter Fullscreen</button>
		<div class="output">
		</div>
		<pre class="verifier">
			// Combine videos and bookmarks
			function(str) {
				preVerifierHook();
				var fun = eval("(" + str + ")"),
					pairs = fun(),
					got,
					expected = '[{"name":"New Releases","videos":[{"id":65432445,"title":"The Chamber","time":32432,"boxart":"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg"},{"id":675465,"title":"Fracture","time":3534543,"boxart":"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg"}]},{"name":"Thrillers","videos":[{"id":70111470,"title":"Die Hard","time":645243,"boxart":"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg"},{"id":654356453,"title":"Bad Boys","time":984934,"boxart":"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg"}]}]';

				got = JSON.stringify(pairs);
				if (got !== expected) {
					showLessonErrorMessage(expected, got);
				}
			}
		</pre>
        <pre class="answer">
			function() {
				var lists = [
						{
							"id": 5434364,
							"name": "New Releases"
						},
						{
							"id": 65456475,
							name: "Thrillers"
						}
					],
					videos = [
						{
							"listId": 5434364,
							"id": 65432445,
							"title": "The Chamber"
						},
						{
							"listId": 5434364,
							"id": 675465,
							"title": "Fracture"
						},
						{
							"listId": 65456475,
							"id": 70111470,
							"title": "Die Hard"
						},
						{
							"listId": 65456475,
							"id": 654356453,
							"title": "Bad Boys"
						}
					],
					boxarts = [
						{ videoId: 65432445, width: 130, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg" },
						{ videoId: 65432445, width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg" },
						{ videoId: 675465, width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture200.jpg" },
						{ videoId: 675465, width: 120, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg" },
						{ videoId: 675465, width: 300, height:200, url:"http://cdn-0.nflximg.com/images/2891/Fracture300.jpg" },
						{ videoId: 70111470, width: 150, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" },
						{ videoId: 70111470, width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/DieHard200.jpg" },
						{ videoId: 654356453, width: 200, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg" },
						{ videoId: 654356453, width: 140, height:200, url:"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg" }
					],
					bookmarks = [
						{ videoId: 65432445, time: 32432 },
						{ videoId: 675465, time: 3534543 },
						{ videoId: 70111470, time: 645243 },
						{ videoId: 654356453, time: 984934 }
					];

				return lists.map(function(list) {
					return {
						name: list.name,
						videos:
							videos.
								filter(function(video) {
									return video.listId === list.id;
								}).
								concatMap(function(video) {
									return Array.zip(
										bookmarks.filter(function(bookmark) {
											return bookmark.videoId === video.id;
										}),
										boxarts.filter(function(boxart) {
											return boxart.videoId === video.id;
										}).
										reduce(function(acc,curr) {
											return acc.width * acc.height < curr.width * curr.height ? acc : curr;
										}),
										function(bookmark, boxart) {
											return { id: video.id, title: video.title, time: bookmark.time, boxart: boxart.url };
										});
							})
					};
				});

			}
        </pre>
		<p class="post">Wow! That's a large query, but the code is still small relative to the amount of work it's doing. If
			we rewrote this query with a series of loops our code would be much less self-describing. Loops don't give the
			reader any information about the kind of operation being performed. Every time you see a loop, you need to
			carefully read through the code to find out what's being done. Is it a projection? A filter? A reduction? Why
			use loops for querying data when we've demonstrated that the 5 functions can be used to create virtually any
			output we want?</p>
	</div>

	<div class="lesson">

		<h1>Congratulations!</h1>

		<p>You've made it this far, but you're not done. Learning is an on-going process. Go out and start
			using the functions you've learned in your day-to-day coding!
		</p>
	</div>
    <div class="modal fade" id="modalGetJSON">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Enter your answer JSON below</h4>
                </div>
                <div class="modal-body">
                    <form>
                        <textarea name="answerText" has-value="true" style="height: 165px;  width:100%; resize: none"></textarea>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary save-btn" data-dismiss="modal">Save changes</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
	<div class="modal fade" id="modalShowJSON">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
							aria-hidden="true">&times;</span></button>
					<h4 class="modal-title">Ctrl-C your answer JSON below</h4>
				</div>
				<div class="modal-body">
					<form>
						<textarea name="answerText" readonly="readonly" has-value="true" style="height: 165px; width:100%; resize: none"></textarea>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal-dialog -->
	</div>
</div>

<script src="assets/app/wordlist.js"></script>
<script src="assets/codemirror/codemirror.js"></script>
<script src="assets/codemirror/matchbrackets.js"></script>
<script src="assets/app/javascript.js"></script>

<script src="https://unpkg.com/@reactivex/rxjs@5.5.10/dist/global/Rx.js"></script>

<script src="assets/jquery/jquery-1.10.2.min.js"></script>
<script src="assets/bootstrap/js/bootstrap.min.js"></script>
<script src="assets/app/grab_answers.js"></script>
<script src="assets/app/show_answers.js"></script>

<script src="assets/app/utils.js"></script>
<script src="assets/app/main.js"></script>
<script type="text/javascript">

	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-37739914-1']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script');
		ga.type = 'text/javascript';
		ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(ga, s);
	})();

</script>
</body>
</html>
